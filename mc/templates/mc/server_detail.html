{% extends "layout.html" %}

{% block title %}Server {{ addr  }}{% endblock %}

{% block head_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='c/server.css') }}" media="all" />
{% endblock %}

{% block main %}
<ul class="breadcrumb">
  <li>
    <a href="/">Home</a> <span class="divider">/</span>
  </li>
  <li>
    <a href="/servers">Servers</a> <span class="divider">/</span>
  </li>
  <li class="active">{{ addr }}</li>
</ul>

<div class="well">

    <div class="btn btn-large">{{  addr }}</div>
    <h3>Basic Stats</h3>
    <div class="row-fluid">
        <div id="hits_stats" class="span6"></div>
        <div id="usage_stats" class="span6"></div>
    </div>

    <h3>Slabs Stats</h3>
    <div id="slabs_stats"></div>
    
    <h3>Slabs Key</h3>
    <div class="btn-group">
        {% for slab in slabs_stats  %}
        <button class="btn">{{slab.slab_id}}</button>
        {% endfor %}
    </div>

</div>
{% endblock %}

{% block footer_script %}
<script type="text/javascript" src="{{ url_for('static', filename='amcharts/amcharts.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='amcharts/raphael.js') }}"></script>

<script type="text/javascript">
    var chart;
    var slabs_data = {{ slabs_stats_str|safe }};
    var stats_data = {{ stats_str|safe }};
    var hits_data = {{ hits_stats_str|safe }};
    var usage_data = [{
        'type':'used', 
        'color' : '#00ff00',
        'value' : {{ stats['bytes'] }},
        'h_value' : '{{ stats['bytes']|human_readable_size }}'
    },
    {
        'type' : 'free',
        'color': '#666666',
        'value' : {{ stats['limit_maxbytes']|int- stats['bytes']|int }},
        'h_value' : '{{ (stats['limit_maxbytes']|int- stats['bytes']|int)|human_readable_size }}'
    }];


    AmCharts.ready(function () {
        // SERIAL CHART
        chart = new AmCharts.AmSerialChart();
        chart.dataProvider = slabs_data;
        chart.categoryField = "slab_id";
        chart.startDuration = 1;

        // AXES
        // category
        var categoryAxis = chart.categoryAxis;
        categoryAxis.labelRotation = 0;
        categoryAxis.gridPosition = "start";

        // value
        // in case you don't want to change default settings of value axis,
        // you don't need to create it, as one value axis is created automatically.
        var valueAxis = new AmCharts.ValueAxis();
        valueAxis.stackType = "regular";
        valueAxis.gridAlpha = 0.1;
        valueAxis.axisAlpha = 0;
        chart.addValueAxis(valueAxis);

        // GRAPH
        var graph = new AmCharts.AmGraph();
        graph.valueField = "used_chunks";
        graph.balloonText = "slab [[slab_id]]: [[used_chunks]] used chunks";
        graph.type = "column";
        graph.lineAlpha = 0;
        graph.fillAlphas = 0.8;
        chart.addGraph(graph);

        var graph = new AmCharts.AmGraph();
        graph.valueField = "free_chunks";
        graph.balloonText = "slab [[slab_id]]: [[free_chunks]] free chunks";
        graph.type = "column";
        graph.lineAlpha = 0;
        graph.fillAlphas = 0.8;
        graph.lineColor = '#00ff00';
        chart.addGraph(graph);

        chart.write("slabs_stats");

        chart = new AmCharts.AmPieChart();
        chart.dataProvider = hits_data;
        chart.titleField = "type";
        chart.valueField = "value";
        chart.outlineColor = "#FFFFFF";
        chart.outlineAlpha = 0.8;
        chart.colorField = "color";
        chart.outlineThickness = 1.2;
        chart.labelRadius = 15;
        //chart.startEffect = '>';
        chart.startDuration = 0;
        //chart.startRadius = '200%'
        chart.labelText = "[[title]]\n [[percents]]% ";
        // WRITE
        chart.write("hits_stats");

        chart = new AmCharts.AmPieChart();
        chart.dataProvider = usage_data;
        chart.titleField = "type";
        chart.valueField = "value";
        chart.descriptionField = 'h_value';
        chart.outlineColor = "#FFFFFF";
        chart.outlineAlpha = 0.8;
        chart.colorField = "color";
        chart.outlineThickness = 1.2;
        chart.labelRadius = 15;
        //chart.startEffect = '>';
        chart.startDuration = 0;
        //chart.startRadius = '200%'
        chart.balloonText = "[[title]] [[percents]]%  [[description]]";
        chart.labelText = "[[title]] [[percents]]%  [[description]]";
        // WRITE
        chart.write("usage_stats");

    });
</script>

{% endblock %}

