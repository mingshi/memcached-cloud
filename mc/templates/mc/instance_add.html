{% extends "layout.html" %}

{% block title %}Instance Add{% endblock %}

{% block main %}
<ul class="breadcrumb">
  <li>
    <a href="/">Home</a> <span class="divider">/</span>
  </li>
  <li class="active">Instance Add</li>
</ul>

<div class="well">
    <form class="form-horizontal">
        <fieldset>
            <legend>Instance Add</legend>
                <div id="instance_add_notice" style="display:none;" class="alert">
                    <button data-dismiss="alert" class="close">x</button>
                    <span id="instance_add_msg"> </span>
                </div>
                <div class="control-group">
                    <label class="control-label" for="host">Select Host</label>
                    <div class="controls">
                        <select name="host" id="host">
                            {% for sid in servers %}
                                <option value="{{ sid }}">{{ sid }}</option>
                            {% endfor %}
                        </select>
                        <p class="help-block">select the host you want the instance running on</p>
                    </div>
                    <label class="control-label" for="param">Start Parameters</label>
                    <div class="controls">
                        <textarea id="param" name="param"></textarea>
                        <p class="help-block">input your memcache start parameters</p>
                    </div>
                </div>
                <div class="control-label">
                    <button type="button" id="ok" class="btn btn-primary">Add</button>
                </div>
        </fieldset>
    </form>
</div>
{% endblock %}
{% block footer_script %}
    <script src="{{ url_for('static', filename='jquery.colorAnimations.js') }}"></script>
    <script type="text/javascript">
        $(function(){
            $('#ok').click(function(){
                if($("#param").val()==""){
                    $("#param").animate({ backgroundColor: "#FFB5B5" }, 500)
                        .animate({ backgroundColor: "#FFFFFF" }, 1000);
                }else{
                    if (! confirm('Are you sure to install memcached on this host?')) {
                        return false;
                    }
                    $('#instance_add_notice').show();
                    $('#instance_add_msg').html('<img src=' + "{{ url_for('static', filename='loading.gif') }}" + ' /> Being processed,Please wait...');
                    var host = $("#host").val();
                    var param = $("#param").val();
                    $('#param').val('');
                    $.ajax({
                        url : "/instance/do_add",
                        dataType : "json",
                        type : 'post',
                        data : {'host' : host, 'param' : param}
                    }).done(function(result){
                        $('#instance_add_msg').html(result.status); 
                    });
                } 
            });
        });
    </script>
{% endblock %}
